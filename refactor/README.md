# サンプル for PHP Conference Fukuoka 2017

## 設定

フロントからAPIにAjax通信、レスポンス内容に合わせてデータ整形を行い返り値オブジェクトとして返却する。

サービスはメモ共有サービス、タイトルと文章(optional)を投稿、閲覧できる。

## Step0

何も手を加えていない状態。

## Step1

なにはひとまず`// @flow`を書き足そう。

JavaScriptでは引数を求められる関数に引数を渡さなくても動く。

引数に型宣言を行おう。

また、必須でない引数はnullableにしよう。

## Step2

リクエストパラメータが1つ増えた。

固定値で`active`か`inactive`を渡さなければいけないらしい。

定数を保持するだけのModuleを作ってもいいがここは1つ、ENUMとして型を宣言しよう。

## Step3

データの取得先をオフラインの際はLocalStorageに切り替えるような仕様変更があった。

データアクセスを外部クラスに切り出し、引数に渡すことで参照先を切り替えるよう疎結合に作ったがLocalStorageとAPI、それぞれのクラスでI/Fを揃え続けるのはめんどくさい。

interfaceによるDuck Typingを行い抽象化を行おう。

## Step4

メモオブジェクトを取得する際の返り値はObjectで定義しているが実態は複雑な構造のデータである。

このままだとデータ構造が変更された時にバグに気が付きづらい。

Objectスキーマの型を定義しよう。

## Step5

Objectに余計なキーが生えると困る？大丈夫、flowならその縛りもできる。

## Step6

通信回数の節約のため、1レスポンスにそのデータに付随するデータを全て返すようにした。

先程定義したObject型を拡張してもよいが意味合いの違うものはバラバラに宣言し、mixin typesで対応して使い回しの効くようにしよう。

## Step7

日付を文字列で持っているがその文字列が正しい日付の体裁をなしているかのチェックができない。

TypeAliasを使用して新たな型を定義し、それを返すmoduleを作成しよう。
